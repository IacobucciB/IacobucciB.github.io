<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>LARP</title>
<!-- Leaflet -->
<link
  rel="stylesheet"
  href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
/>
<!-- Pico.css (CSS ligero) -->
<link
  rel="stylesheet"
  href="https://unpkg.com/@picocss/pico@1/css/pico.min.css"
/>
<style>
html, body {
  height: 100%;
  margin: 0;
}
/* wrapper central */
.wrapper {
  min-height: 100vh;
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
  gap: 1rem;
  padding: 2rem;
}
/* título */
h1 {
  margin: 0;
  letter-spacing: 0.15em;
  text-align: center;
}
/* mapa rectangular - responsive */
#map {
  width: 90vw;
  max-width: 900px;
  height: 500px;
  border-radius: 12px;
  box-shadow: 0 6px 20px rgba(0,0,0,.15);
}

/* En móviles: más alto que ancho */
@media (max-width: 768px) {
  .wrapper {
    padding: 1rem;
  }
  
  #map {
    width: 90vw;
    height: 70vh;
    max-height: 600px;
  }
}

/* FIX Leaflet + Pico */
.leaflet-control button,
.leaflet-bar a {
  all: unset;
  display: block;
  width: 30px;
  height: 30px;
  line-height: 30px;
  text-align: center;
  background: white;
  border: 1px solid #ccc;
  cursor: pointer;
  font-size: 18px;
}
.leaflet-bar {
  box-shadow: none;
}
.leaflet-control button:hover,
.leaflet-bar a:hover {
  background: #f0f0f0;
}
.leaflet-container * {
  box-sizing: content-box;
}
</style>
</head>
<body>
<div class="wrapper">
  <h1>LARP</h1>
  <div id="map"></div>
</div>

<!-- Modal para el Centro de la Ciudad -->
<dialog id="centerModal">
  <article>
    <header>
      <strong>Centro de la Ciudad de La Plata</strong>
    </header>
    <p>
      Capital de la Provincia de Buenos Aires, fundada en 1882.
      Destaca por su trazado en cuadrícula con diagonales,
      planificación geométrica y arquitectura neogótica.
    </p>
    <p>
      Coordenadas aproximadas del centro:
      <br>
      Lat: -34.9214
      <br>
      Lng: -57.9544
    </p>
    <footer>
      <button onclick="closeCenterModal()">Cerrar</button>
    </footer>
  </article>
</dialog>

<!-- Modal para el Polígono -->
<dialog id="polygonModal">
  <article>
    <header>
      <strong>Área del Casco Urbano</strong>
    </header>
    <p>
      Este polígono representa el casco urbano fundacional de La Plata,
      conocido por su diseño urbanístico único en forma de cuadrado
      con diagonales que convergen en la Plaza Moreno.
    </p>
    <p>
      El trazado fue diseñado por el arquitecto Pedro Benoit y es
      considerado Patrimonio Cultural de la Humanidad por la UNESCO.
    </p>
    <footer>
      <button onclick="closePolygonModal()">Cerrar</button>
    </footer>
  </article>
</dialog>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script>
const center = [-34.9214, -57.9544];

const map = L.map("map").setView(center, 13);

L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
  maxZoom: 19
}).addTo(map);

/* =========================
   GENERIC MODAL FACTORY
========================= */

function createModal(id, title, content) {
  const dialog = document.createElement("dialog");
  dialog.id = id;

  dialog.innerHTML = `
    <article>
      <header><strong>${title}</strong></header>
      <p>${content}</p>
      <footer>
        <button onclick="document.getElementById('${id}').close()">Cerrar</button>
      </footer>
    </article>
  `;

  document.body.appendChild(dialog);
  return dialog;
}

/* =========================
   LOAD MARKERS
========================= */

fetch("./data/markers.json")
.then(r => r.json())
.then(markers => {

  markers.forEach(m => {

    const modal = createModal(m.id, m.title, m.content);

    const icon = L.icon({
      iconUrl: m.icon,
      iconSize: m.iconSize,
      iconAnchor: [m.iconSize[0]/2, m.iconSize[1]],
      popupAnchor: [0, -m.iconSize[1]]
    });

    L.marker([m.lat, m.lng], {icon})
      .addTo(map)
      .on("click", () => modal.showModal());
  });

});

/* =========================
   LOAD POLYGONS
========================= */

fetch("./data/polygons.json")
.then(r => r.json())
.then(polygons => {

  polygons.forEach(p => {

    const modal = createModal(p.id, p.title, p.content);

    L.polygon(p.points, {
      color: p.color,
      fillColor: p.color,
      fillOpacity: p.opacity
    })
    .addTo(map)
    .on("click", () => modal.showModal());
  });

});

/* Fix responsive */
setTimeout(() => map.invalidateSize(), 100);
</script>

</body>
</html>